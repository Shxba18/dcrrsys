const { EmbedBuilder } = require("discord.js");

const reputationData = new Map(); // UklÃ¡dÃ¡ reputace a Äasy

module.exports = {
  name: "rep",
  description: "ZobrazÃ­ nebo udÄ›lÃ­ reputaci",

  async execute(message, args) {
    const sub = args[0];

    if (sub === "view") {
      let target = message.mentions.users.first() || message.author;

      const rep = reputationData.get(target.id) || { given: 0, received: 0, lastGiven: 0 };

      const embed = new EmbedBuilder()
        .setTitle(`ğŸ“Š reputation ${target.username}`)
        .setColor("#000000")
        .setImage('https://media.tenor.com/WIG0ro4UEYIAAAAd/lean-po-sum-mo.gif')
        .setThumbnail(target.displayAvatarURL())
        .addFields(
          { name: " rep given", value: `${rep.given}`, inline: true },
          { name: "rep received", value: `${rep.received}`, inline: true }
        );

      return message.reply({ embeds: [embed] });
    }

    else if (sub === "give") {
      const target = message.mentions.users.first();
      if (!target) return message.reply("âŒ OznaÄ uÅ¾ivatele, kterÃ©mu chceÅ¡ dÃ¡t reputaci.");
      if (target.bot) return message.reply("âŒ NemÅ¯Å¾eÅ¡ dÃ¡vat reputaci botÅ¯m.");
      if (target.id === message.author.id) return message.reply("âŒ NemÅ¯Å¾eÅ¡ dÃ¡t reputaci sÃ¡m sobÄ›.");

      const now = Date.now();
      const authorData = reputationData.get(message.author.id) || { given: 0, received: 0, lastGiven: 0 };

      if (now - authorData.lastGiven < 24 * 60 * 60 * 1000) {
        const remaining = 24 * 60 * 60 * 1000 - (now - authorData.lastGiven);
        const hours = Math.floor(remaining / (1000 * 60 * 60));
        const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
        return message.reply(`ğŸ•’ MÅ¯Å¾eÅ¡ znovu dÃ¡t reputaci za ${hours}h ${minutes}min.`);
      }

      authorData.given += 1;
      authorData.lastGiven = now;
      reputationData.set(message.author.id, authorData);

      const targetData = reputationData.get(target.id) || { given: 0, received: 0, lastGiven: 0 };
      targetData.received += 1;
      reputationData.set(target.id, targetData);

      const embed = new EmbedBuilder()
        .setColor("#4B0082")
        .setDescription(`âœ… ${target} zÃ­skal +1 reputaci!`)
        .setFooter({ text: `Od ${message.author.username}` })
        .setTimestamp();

      return message.reply({ embeds: [embed] });
    }

    else {
      return message.reply("âŒ PouÅ¾itÃ­: `!rep view [@uÅ¾ivatel]` nebo `!rep give @uÅ¾ivatel`");
    }
  }
};
